### Second Wind - Implementation Plan

**Development Overview:**
- 8 phases over 11 weeks
- Phase-by-phase tracking for session continuity
- Each phase builds on the previous to ensure stable progression
- **Pure C++ Implementation:** No visual scripting/Blueprints for gameplay
- **SINGLE-PLAYER ONLY:** No multiplayer, networking, or replication code
- **NO GAS:** Do NOT use Gameplay Ability System - implement all abilities with simple C++ components
- **UI System:** All UI implemented in C++ using Slate framework
- **Blueprints:** Only for asset references and minimal configuration

**Current Status:** Phase 5C - Pre-Placed Level Design System ðŸ“‹ PLANNED
**Previous:** Phase 5B - Physical Room System âœ… COMPLETED
**Next Session:** Implement Phase 5C - Pre-Placed Level Design

=============================================================================

### PHASE 1: COMBAT FOUNDATION (Week 1-2)
**Priority:** CRITICAL - Core Gameplay
**Status:** âœ… COMPLETED

**Goals:**
- Basic attack system working
- Health system functional
- Training dummy for testing
- Player movement adjusted to game requirements

**Tasks:**
1. [âœ…] Modify ASecondWindCharacter
   - Set MaxWalkSpeed to 300 (currently 500)
   - Remove jump functionality completely
   - Add basic attack input binding (LMB -> IA_Attack)
   - Ensure character faces enemy after animations

2. [âœ…] Create UCombatComponent
   - Basic attack function (5 base damage)
   - Animation-based cooldown system
   - Hit detection and damage application
   - Integration with character class

3. [âœ…] Create UHealthComponent
   - 100 HP base system
   - 2-phase player health system
   - Damage interface for receiving hits
   - Death/phase transition logic

4. [âœ…] Create ATrainingDummy (extends ACharacter)
   - 100 HP, 2 phases structure
   - Basic hit reaction animations (simple initially)
   - Auto-respawn on death functionality
   - Placeholder combat responses
   - Complex training behaviors added later

**Deliverable:** Player can attack training dummy with functional health/damage system
**Testing:** Player attacks reduce dummy health, dummy dies and respawns after 2 phases

=============================================================================

### PHASE 2: BLOCKING SYSTEM (Week 3)
**Priority:** HIGH - Core Combat Mechanic
**Status:** âœ… COMPLETED

**Goals:**
- Directional blocking fully functional
- Mouse delta system working
- Counter-attack windows implemented
- Block animations integrated

**Tasks:**
1. [âœ…] Create UBlockingComponent
   - RMB hold detection and state management
   - Horizontal mouse delta tracking (1D axis only, vertical ignored)
   - Block direction states (Front/Left/Right) based on horizontal zones
   - 40% damage reduction calculation (no parry system)
   - Block zone threshold adjusted to 0.5 for better center detection

2. [âœ…] Enhanced Input Integration
   - Create IA_Block input action
   - Mouse horizontal axis for block control (camera stays centered on enemy)
   - Block direction change with horizontal mouse movements only
   - Input buffer system ready for implementation

3. [âœ…] Counter-Attack System Foundation
   - 0.5 second counter-attack windows
   - Counter window triggers after successful block
   - Visual feedback with debug spheres
   - Integrated with HealthComponent for damage reduction
   - Foundation for hack meter tracking

**Deliverable:** Functional directional blocking with successful counter-attacks
**Testing:** Player can block attacks from different directions and counter-attack

=============================================================================

### PHASE 3: DODGE & MOVEMENT (Week 4)
**Priority:** HIGH - Core Combat Mechanic
**Status:** PENDING

**Goals:**
- Strategic dodge system complete
- Camera lock-on basic functionality
- Strafe movement during combat
- Complete combat triangle (Attack/Block/Dodge)

**Tasks:**
1. [ ] Strategic Dodge Implementation
   - A/S/D hold (0.1s) + Space input combinations
   - Dodge direction logic (left/back/right)
   - Animation-driven movement (no code distance)
   - Counter-attack windows after successful dodges
   - Weak side bonus damage for proper positioning

2. [ ] Camera Lock-On Foundation
   - Create UCameraLockOnComponent
   - Auto-targeting logic within 1500 unit range (1v1 only)
   - No manual toggle or lock break (arena combat design)
   - Strafe movement when locked onto target
   - Character auto-facing enemy with animation exceptions
   - Camera lag for smooth dodge following

3. [ ] Movement System Integration
   - Modify WASD behavior during lock-on
   - A/D becomes strafe/circle movement
   - Seamless transition between free/locked movement

**Deliverable:** Complete basic combat mechanics (Attack/Block/Dodge/Lock-on)
**Testing:** All three combat options work together fluidly

=============================================================================

### PHASE 4: ADVANCED COMBAT (Week 5)
**Priority:** MEDIUM - Enhanced Combat
**Status:** COMPLETED âœ“

**Goals:**
- Dash attack system functional âœ“
- Hack attack fully implemented âœ“
- Counter-attack tracking system âœ“
- Complete combat moveset âœ“

**Tasks:**
1. [x] Dash Attack System
   - W + Space dash input detection âœ“
   - Forward dash movement (using DodgeComponent) âœ“
   - Optional LMB leap attack during dash window âœ“
   - Basic implementation without animations âœ“

2. [x] Hack Attack Implementation
   - Counter-attack tracking system (6-count) âœ“
   - Reset logic on 2 unblocked hits (blocked don't count) âœ“
   - Massive damage (50) + stun placeholder âœ“
   - Visual/audio feedback for hack availability âœ“
   - UI debug display (cyan progress indicators) âœ“
   - Counter-attacks require LMB during counter windows âœ“

**Deliverable:** Full combat moveset with all special abilities âœ“
**Testing:** Hack attack becomes available after 6 counters, resets properly âœ“

=============================================================================

### PHASE 5A: ARENA SYSTEM - BASIC (Week 6)
**Priority:** HIGH - Game Structure
**Status:** âœ… COMPLETED

**Goals:**
- Game mode and progression structure
- Arena transition system
- Enemy base class with phases
- Fragment earning system

**Tasks:**
1. [âœ…] Game Mode Implementation
   - Create ASecondWindArenaGameMode (extends AGameModeBase)
   - Arena progression logic and state management
   - Safe zone and training area management

2. [âœ…] Arena Management System
   - Create AArenaManager for transitions
   - Arena 1-5 basic setup (identical layouts)
   - Safe zone between arenas functionality

3. [âœ…] Enemy Base Class
   - Create AArenaEnemy (extends ACharacter)
   - Phase system implementation (1-5 phases per arena)
   - Health scaling and phase transitions (100 HP reset)
   - Finisher system with forced waiting animations
   - Glowing weak side visual indicators (placeholder)

4. [âœ…] Fragment System Foundation
   - Finisher-based fragment earning calculation
   - Cumulative phase rewards (1+2+3+4 = 10 for 4-phase enemy)
   - Fragment counting and persistence preparation

**Deliverable:** Working arena progression with basic enemy system
**Testing:** Can progress through arenas, earn fragments from finishers

=============================================================================

### PHASE 5B: PHYSICAL ROOM SYSTEM (Week 6-7)
**Priority:** HIGH - Enhanced Game Structure
**Status:** âœ… COMPLETED

**Goals:**
- Physical room-based progression (no teleporting)
- Proximity-based door interactions (2-second hold)
- Simple linear progression through connected spaces
- Safe zone corridors as marketplaces between arenas

**Refactoring Tasks:**
1. [âœ…] Remove Phase 5A Placeholder Code
   - Removed teleportation logic from ArenaManager
   - Removed debug keys (1 and 2) for arena transitions
   - Simplified GameMode (no complex state management)
   - Removed spawn/despawn location arrays
   - Kept only: FragmentComponent, ArenaEnemy base class

**New Implementation Tasks:**
2. [âœ…] Arena Door System
   - Created AArenaDoor (interactive door with proximity detection)
   - 2-second proximity requirement implemented
   - Door opening sequence working
   - Combat-locked exit doors (must defeat enemy)
   - Door type system (ArenaEntry, ArenaExit, SafeZone)

3. [âœ…] Safe Zone Corridors
   - Created ASafeZoneCorridor (marketplace hallways)
   - Healing to full health on entry
   - Linear corridor design between arenas
   - No combat in corridors

4. [âœ…] Physical Level Layout
   - SimplifiedArenaSystem spawns rooms dynamically
   - Starting Hub (training dummy) â†’ Door 1 â†’ Arena 1 â†’ etc.
   - Each room physically exists (no teleporting)
   - Clear progression flow
   - Doors lock/unlock based on combat state

5. [âœ…] Simplified Enemy Management
   - Only one arena enemy exists at a time
   - Current enemy spawns when entering arena
   - Previous enemy despawns automatically
   - No complex respawn logic
   - Enemy tied to specific arena room

**Key Simplifications from 5A:**
- No teleportation (walk everywhere)
- No complex state machines (proximity triggers handle flow)
- Single enemy at a time (no multi-enemy management)
- Linear progression (no backtracking complexity)
- Physical space tells the story (no abstract systems)

**Deliverable:** Clean, physical room-based progression âœ… DELIVERED
**Testing:** Walk to door â†’ Wait 2 seconds â†’ Door opens â†’ Enter arena â†’ Defeat enemy â†’ Walk to safe zone â†’ Get healed â†’ Continue

=============================================================================

### PHASE 5C: PRE-PLACED LEVEL DESIGN SYSTEM (Week 7)
**Priority:** HIGH - Professional Level Design
**Status:** ðŸ“‹ PLANNED

**Goals:**
- Transform runtime-spawned system to editor-placed geometry
- Full visual control over level layout in Unreal Editor
- Discovery-based management (find pre-placed actors)
- Support for non-linear level designs
- Maintain all Phase 5B functionality

**New Classes to Create:**
1. [ ] AArenaZone
   - Defines combat area boundaries
   - Zone number and name properties
   - References to entry/exit doors
   - Enemy spawn point management
   - Combat state tracking

2. [ ] AEnemySpawnPoint
   - Visual spawn location markers
   - Enemy type selection
   - Phase count override option
   - Training dummy flag
   - Rotation control

3. [ ] ALevelLayoutManager (Replaces SimplifiedArenaSystem)
   - Discovers all pre-placed actors on BeginPlay
   - Manages enemy spawning only (no geometry spawning)
   - Tracks arena progression
   - Updates door states based on combat
   - Validates level setup

**Implementation Tasks:**
1. [ ] Discovery System
   - Find all ArenaZones in level
   - Find all EnemySpawnPoints
   - Find all Doors and Corridors
   - Link components together
   - Validate connections

2. [ ] Zone Management
   - Player overlap detection
   - Zone activation/deactivation
   - Combat state per zone
   - Door state updates

3. [ ] Spawn Point System
   - Spawn enemies at designated points
   - Clear spawn points on zone change
   - Support multiple enemy types
   - Respawn training dummy

**Level Design Workflow:**
1. Place ALevelLayoutManager in level
2. Place AArenaZone actors for each combat area
3. Scale zone bounds to desired size
4. Place AEnemySpawnPoint inside each zone
5. Place AArenaDoor actors between zones
6. Place ASafeZoneCorridor actors
7. Link references in editor
8. Test progression

**Benefits:**
- Visual level design in editor
- Custom arena shapes and sizes
- Non-linear progression possible
- Easy testing and iteration
- Professional workflow

**Deliverable:** Editor-friendly level design system
**Testing:** Place actors in editor â†’ Play in editor â†’ System discovers layout â†’ Combat and progression work

**See Phase5C_Plan.md for detailed implementation guide**

=============================================================================

### PHASE 6: MEMORY SYSTEM (Week 8)
**Priority:** MEDIUM - Meta Progression
**Status:** PENDING

**Goals:**
- Save/load system working
- Memory unlock interface
- First memory implemented
- Persistence between sessions

**Tasks:**
1. [ ] Save/Load Infrastructure
   - Create UFragmentSystem (UGameInstanceSubsystem)
   - Create UMemorySystem (UGameInstanceSubsystem)
   - UE5 save game system integration
   - Persistent fragment and memory data

2. [ ] Memory System Implementation
   - Memory unlock validation system
   - Gameplay effect application framework
   - Safe zone memory spending interface

3. [ ] First Memory: Hack Attack Reduction
   - Reduce hack requirement from 6 to 4 counter-attacks
   - Memory purchase and effect application
   - Save/load memory unlock state

**Deliverable:** Working memory system with hack attack upgrade
**Testing:** Can spend fragments to unlock memory, effect persists between sessions

=============================================================================

### PHASE 7: UI & POLISH (Week 8)
**Priority:** MEDIUM - User Experience
**Status:** PENDING

**Goals:**
- Combat UI implemented
- Basic Slate UI systems
- UI feedback for all mechanics

**Tasks:**
1. [ ] Core Combat UI (Pure C++ Slate)
   - Enemy health bar (top, wide design) - Slate widget
   - Player health bar (bottom-left) - Slate widget
   - Phase indicators for both player and enemy - Slate
   - Fragment counter display - Slate widget
   - Damage numbers below health bar (Elden Ring style) - Slate
   - Counter-attack arrows (left-center, cyan/red states) - Slate
   - Hack meter proper UI (replace debug display)

2. [ ] UI State Management
   - Menu system (main menu, pause menu)
   - Arena transition screens
   - Victory/defeat screens
   - Memory purchase interface

**Deliverable:** Complete UI system with all necessary screens
**Testing:** All UI elements display correctly and update in real-time

=============================================================================

### PHASE 8: ANIMATION SYSTEM (Week 9)
**Priority:** HIGH - Visual Polish
**Status:** PENDING

**Goals:**
- Complete animation integration
- Smooth combat feel
- Visual feedback for all actions

**Tasks:**
1. [ ] Player Animations
   - Attack animations (normal, counter, hack)
   - Block animations (directional)
   - Dodge animations (4 directions)
   - Dash and leap attack animations
   - Hit reactions and death animations
   - Phase transition animations

2. [ ] Enemy Animations
   - Attack animations (combos, heavy attacks)
   - Hit reactions
   - Phase transition animations
   - Death and finisher receive animations

3. [ ] Animation Notifies
   - Damage frame timing
   - Counter window triggers
   - VFX spawn points
   - SFX triggers

**Deliverable:** Fully animated combat system
**Testing:** All animations play correctly with proper timing

=============================================================================

### PHASE 9: SFX & VFX (Week 10)
**Priority:** MEDIUM - Audio/Visual Polish
**Status:** PENDING

**Goals:**
- Complete audio implementation
- Visual effects for all actions
- Game feel enhancement

**Tasks:**
1. [ ] Sound Effects
   - Combat sounds (sword hits, blocks, dodges)
   - Counter-attack audio cues
   - Hack attack charging and execution
   - UI feedback sounds
   - Phase transition audio
   - Ambient arena sounds

2. [ ] Visual Effects
   - Hit impacts and sparks
   - Blood/damage effects
   - Counter-attack window visual indicators
   - Block direction visual feedback
   - Hack attack visual buildup and execution
   - Dodge trails and dash effects
   - Phase transition effects

3. [ ] Game Feel
   - Screen shake on heavy hits
   - Hit pause for impactful attacks
   - Slow motion for counter-attacks
   - Camera effects for special moments

**Deliverable:** Complete audio-visual experience
**Testing:** All effects trigger correctly without performance issues

=============================================================================

### PHASE 10: ENEMY AI (Week 11)
**Priority:** HIGH - Core Gameplay
**Status:** PENDING

**Goals:**
- Intelligent enemy behavior
- Challenging combat encounters
- Phase-based AI changes

**Tasks:**
1. [ ] AI Behavior System
   - State machine for combat decisions
   - Attack pattern selection
   - Player action reading and response
   - Distance management
   - Defensive behavior (blocking, dodging)

2. [ ] Attack Patterns
   - 3-hit combo variations
   - Heavy attack mixups
   - Feint system (start attack, then cancel)
   - Delayed attacks to catch dodges
   - Punish patterns for player mistakes

3. [ ] Phase-Based Behaviors
   - Phase 1: Basic attacks, slow reactions
   - Phase 2: Faster attacks, occasional feints
   - Phase 3: Combo chains, defensive options
   - Phase 4: Aggressive mixups, punish attempts
   - Phase 5: Full moveset, unpredictable patterns

4. [ ] Difficulty Scaling
   - Per-arena AI improvements
   - Reaction time adjustments
   - Attack frequency changes
   - Defense usage probability

**Deliverable:** Challenging and fair enemy AI system
**Testing:** AI provides appropriate challenge without feeling unfair

=============================================================================

### SESSION TRACKING:
**Current Phase:** 5B
**Next Tasks:** Implement physical room system with collision-based transitions
**Completion Status:** 5A/10 phases complete (5B pending)

### NOTES FOR NEXT SESSION:
- Phase 1-5A complete: Combat, Blocking, Dodge/Movement, Special Abilities, Basic Arena System
- Phase 5B planned: Physical room progression with doors and marketplaces
- Need to implement:
  * ARoomTrigger for collision-based transitions
  * AArenaDoor for enemy spawning interactions
  * ASafeZoneRoom for marketplace areas
  * Physical level layout with connected rooms
- Room progression: Starting Hub â†’ Arena 1 â†’ Safe Zone 1 â†’ Arena 2 â†’ etc.
- Safe zones will serve as marketplaces for memory purchases
- Enemies respawn when revisiting defeated arenas
- Phase order: 5B Physical Rooms â†’ Memory â†’ UI â†’ Animation â†’ SFX/VFX â†’ Enemy AI
- Training dummy remains in starting hub